var ballistics=function(){"use strict";const t="undefined"!=typeof BigUint64Array,e=Symbol(),r=1024;function n(t,e){const n=new Uint32Array(t),a=new Uint16Array(t);let i=n[e+-4>>>2]>>>1,o=e>>>1;if(i<=r)return String.fromCharCode.apply(String,a.subarray(o,o+i));let c="";do{const t=a[o+r-1],e=t>=55296&&t<56320?1023:r;c+=String.fromCharCode.apply(String,a.subarray(o,o+=e)),i-=e}while(i>r);return c+String.fromCharCode.apply(String,a.subarray(o,o+i))}function a(t){const e={};function r(t,e){return t?n(t.buffer,e):"<yet unknown>"}const a=t.env=t.env||{};return a.abort=a.abort||function(t,n,i,o){const c=e.memory||a.memory;throw Error(`abort: ${r(c,t)} at ${r(c,n)}:${i}:${o}`)},a.trace=a.trace||function(t,n,...i){const o=e.memory||a.memory;console.log(`trace: ${r(o,t)}${n?" ":""}${i.slice(0,n).join(", ")}`)},a.seed=a.seed||Date.now,t.Math=t.Math||Math,t.Date=t.Date||Date,e}function i(e,r){const a=r.exports,i=a.memory,o=a.table,c=a.__alloc,s=a.__retain,l=a.__rtti_base||-1;function u(t){const e=function(t){const e=new Uint32Array(i.buffer);if((t>>>=0)>=e[l>>>2])throw Error("invalid id: "+t);return e[(l+4>>>2)+2*t]}(t);if(!(7&e))throw Error(`not an array: ${t}, flags=${e}`);return e}function g(t){const e=new Uint32Array(i.buffer);if((t>>>=0)>=e[l>>>2])throw Error("invalid id: "+t);return e[(l+4>>>2)+2*t+1]}function f(t){return 31-Math.clz32(t>>>6&31)}function _(t,e,r){const n=i.buffer;if(r)switch(t){case 2:return new Float32Array(n);case 3:return new Float64Array(n)}else switch(t){case 0:return new(e?Int8Array:Uint8Array)(n);case 1:return new(e?Int16Array:Uint16Array)(n);case 2:return new(e?Int32Array:Uint32Array)(n);case 3:return new(e?BigInt64Array:BigUint64Array)(n)}throw Error("unsupported align: "+t)}function p(t){const e=new Uint32Array(i.buffer),r=u(e[t+-8>>>2]),n=f(r);let a=4&r?t:e[t+4>>>2];const o=2&r?e[t+12>>>2]:e[a+-4>>>2]>>>n;return _(n,2048&r,4096&r).subarray(a>>>=n,a+o)}function A(t,e,r){return new t(w(t,e,r))}function w(t,e,r){const n=i.buffer,a=new Uint32Array(n),o=a[r+4>>>2];return new t(n,o,a[o+-4>>>2]>>>e)}function b(t,r,n){e["__get"+r]=A.bind(null,t,n),e[`__get${r}View`]=w.bind(null,t,n)}return e.__allocString=function(t){const e=t.length,r=c(e<<1,1),n=new Uint16Array(i.buffer);for(var a=0,o=r>>>1;a<e;++a)n[o+a]=t.charCodeAt(a);return r},e.__getString=function(t){const e=i.buffer;if(1!==new Uint32Array(e)[t+-8>>>2])throw Error("not a string: "+t);return n(e,t)},e.__allocArray=function(t,e){const r=u(t),n=f(r),a=e.length,o=c(a<<n,4&r?t:0);let l;if(4&r)l=o;else{const e=c(2&r?16:12,t),y=new Uint32Array(i.buffer);y[e+0>>>2]=s(o),y[e+4>>>2]=o,y[e+8>>>2]=a<<n,2&r&&(y[e+12>>>2]=a),l=e}const y=_(n,2048&r,4096&r);if(16384&r)for(let t=0;t<a;++t)y[(o>>>n)+t]=s(e[t]);else y.set(e,o>>>n);return l},e.__getArrayView=p,e.__getArray=function(t){const e=p(t),r=e.length,n=new Array(r);for(let t=0;t<r;t++)n[t]=e[t];return n},e.__getArrayBuffer=function(t){const e=i.buffer,r=new Uint32Array(e)[t+-4>>>2];return e.slice(t,t+r)},[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array].forEach(t=>{b(t,t.name,31-Math.clz32(t.BYTES_PER_ELEMENT))}),t&&[BigUint64Array,BigInt64Array].forEach(t=>{b(t,t.name.slice(3),3)}),e.__instanceof=function(t,e){const r=new Uint32Array(i.buffer);let n=r[t+-8>>>2];if(n<=r[l>>>2])do{if(n==e)return!0;n=g(n)}while(n);return!1},e.memory=e.memory||i,e.table=e.table||o,y(a,e)}function o(t){return"undefined"!=typeof Response&&t instanceof Response}function c(t){return t instanceof WebAssembly.Module}async function s(t,e={}){if(o(t=await t))return l(t,e);const r=c(t)?t:await WebAssembly.compile(t),n=a(e),s=await WebAssembly.instantiate(r,e);return{module:r,instance:s,exports:i(n,s)}}async function l(t,e={}){if(!WebAssembly.instantiateStreaming)return s(o(t=await t)?t.arrayBuffer():t,e);const r=a(e),n=await WebAssembly.instantiateStreaming(t,e),c=i(r,n.instance);return{...n,exports:c}}function y(t,r={}){r=Object.create(r);const n=t.__argumentsLength?e=>{t.__argumentsLength.value=e}:t.__setArgumentsLength||t.__setargc||(()=>{});for(let a in t){if(!Object.prototype.hasOwnProperty.call(t,a))continue;const i=t[a];let o=a.split("."),c=r;for(;o.length>1;){let t=o.shift();Object.prototype.hasOwnProperty.call(c,t)||(c[t]={}),c=c[t]}let s=o[0],l=s.indexOf("#");if(l>=0){const r=s.substring(0,l),o=c[r];if(void 0===o||!o.prototype){const t=function(...e){return t.wrap(t.prototype.constructor(0,...e))};t.prototype={valueOf(){return this[e]}},t.wrap=function(r){return Object.create(t.prototype,{[e]:{value:r,writable:!1}})},o&&Object.getOwnPropertyNames(o).forEach(e=>Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))),c[r]=t}if(s=s.substring(l+1),c=c[r].prototype,/^(get|set):/.test(s)){if(!Object.prototype.hasOwnProperty.call(c,s=s.substring(4))){let r=t[a.replace("set:","get:")],n=t[a.replace("get:","set:")];Object.defineProperty(c,s,{get(){return r(this[e])},set(t){n(this[e],t)},enumerable:!0})}}else"constructor"===s?(c[s]=(...t)=>(n(t.length),i(...t))).original=i:(c[s]=function(...t){return n(t.length),i(this[e],...t)}).original=i}else/^(get|set):/.test(s)?Object.prototype.hasOwnProperty.call(c,s=s.substring(4))||Object.defineProperty(c,s,{get:t[a.replace("set:","get:")],set:t[a.replace("get:","set:")],enumerable:!0}):"function"==typeof i&&i!==n?(c[s]=(...t)=>(n(t.length),i(...t))).original=i:c[s]=i}return r}var u={instantiate:s,instantiateSync:function(t,e={}){const r=c(t)?t:new WebAssembly.Module(t),n=a(e),o=new WebAssembly.Instance(r,e);return{module:r,instance:o,exports:i(n,o)}},instantiateStreaming:l,demangle:y};(async()=>{const t=pc.Application.getApplication(),e=t.assets.find("ballistics.wasm").getFileUrl(),r=(await(async(t,e)=>(e||(e={env:{abort:()=>console.log("Error! Check your attributes.")}}),await u.instantiate(fetch(t),e)))(e)).exports,n=r.getInputBufferPtr(),a=r.getOutputBufferPtr(),i=r.INPUT_BUFFER_OFFSET.valueOf(),o=r.OUTPUT_BUFFER_OFFSET.valueOf(),c=r.__getArrayView(n);window.Ballistics={range:function(e,n,s){if(s||(s=-t.systems.rigidbody.gravity.y),e<=0||!Number.isFinite(s)||!Number.isFinite(n))return console.warn(`Ballistics: invalid attribute when calling .range(speed, initialHeight, [gravity])\nspeed:\t\t\t${e}\ninitialHeight:\t${n}\ngravity:\t\t${s}`),null;let l=i;c[l++]=e,c[l++]=s,c[l++]=n;return r.range()>0?(l=o,r.__getArray(a)[l]):null},solveStatic:function(e,n,s,l){if(l||(l=-t.systems.rigidbody.gravity.y),s<=0||!(e instanceof pc.Vec3)||!(n instanceof pc.Vec3))return console.warn(`Ballistics: invalid attribute when calling .solveStatic(from, target, speed, [gravity])\nspeed:\t\t\t${s}\nfrom:\t\t\t${e}\ntarget:\t\t\t${n}\ngravity:\t\t${l}`),null;let y=i;c[y++]=e.x,c[y++]=e.y,c[y++]=e.z,c[y++]=s,c[y++]=n.x,c[y++]=n.y,c[y++]=n.z,c[y++]=l;if(r.solveArcStatic()>0){y=o;const t=r.__getArray(a)[y++],e=r.__getArray(a)[y++],n=r.__getArray(a)[y++],i=r.__getArray(a)[y++],c=r.__getArray(a)[y++],s=r.__getArray(a)[y++];return{lowAngle:new pc.Vec3(t,e,n),highAngle:new pc.Vec3(i,c,s)}}return null},solveMoving:function(e,n,s,l,y){if(y||(y=-t.systems.rigidbody.gravity.y),!(!(s<=0)&&e instanceof pc.Vec3&&n instanceof pc.Vec3&&l instanceof pc.Vec3))return console.warn(`Ballistics: invalid attribute when calling .solveMoving(from, target, speed, velocity, [gravity])\nspeed:\t\t\t${s}\nfrom:\t\t\t${e}\nvelocity:\t\t${l}\ntarget:\t${n}\ngravity:\t\t${y}`),null;let u=i;c[u++]=e.x,c[u++]=e.y,c[u++]=e.z,c[u++]=s,c[u++]=n.x,c[u++]=n.y,c[u++]=n.z,c[u++]=l.x,c[u++]=l.y,c[u++]=l.z,c[u++]=y;const g=r.solveArcMoving();if(g>0){u=o;const t=r.__getArray(a)[u++],e=r.__getArray(a)[u++],n=r.__getArray(a)[u++],i=r.__getArray(a)[u++],c=r.__getArray(a)[u++],s=r.__getArray(a)[u++],l=r.__getArray(a)[u++],y=r.__getArray(a)[u++],f=r.__getArray(a)[u++],_=r.__getArray(a)[u++],p=r.__getArray(a)[u++],A=r.__getArray(a)[u++];return{lowAngle:g>0?new pc.Vec3(t,e,n):null,highAngle:g>1?new pc.Vec3(i,c,s):null,s3:g>2?new pc.Vec3(l,y,f):null,s4:g>3?new pc.Vec3(_,p,A):null}}return null},solveLateralStatic:function(e,n,s,l){if(s<=0||l<=0||!(e instanceof pc.Vec3)||!(n instanceof pc.Vec3))return console.warn(`Ballistics: invalid attribute when calling .solveLateralStatic(from, target, speed, height)\nspeed:\t\t${s}\nheight:\t\t${l}\nfrom:\t\t${e}\ntarget:\t\t${n}`),null;let y=i;c[y++]=e.x,c[y++]=e.y,c[y++]=e.z,c[y++]=n.x,c[y++]=n.y,c[y++]=n.z,c[y++]=s,c[y++]=l;if(r.solveLateralStatic()>0){y=o;const e=r.__getArray(a)[y++],n=r.__getArray(a)[y++],i=r.__getArray(a)[y++],c=r.__getArray(a)[y++],s=t.systems.rigidbody.gravity.y+c;return{velocity:new pc.Vec3(e,n,i),force:new pc.Vec3(0,-s,0),gravity:c}}return null},solveLateralMoving:function(e,n,s,l,y){if(!(!(s<=0||y<=0)&&e instanceof pc.Vec3&&n instanceof pc.Vec3&&l instanceof pc.Vec3))return console.warn(`Ballistics: invalid attribute when calling .solveLateralMoving(from, target, speed, velocity, height)\nspeed:\t\t${s}\nheight:\t\t${y}\nfrom:\t\t${e}\ntarget:\t\t${n}\nvelocity:\t${l}`),null;let u=i;c[u++]=e.x,c[u++]=e.y,c[u++]=e.z,c[u++]=n.x,c[u++]=n.y,c[u++]=n.z,c[u++]=s,c[u++]=l.x,c[u++]=l.y,c[u++]=l.z,c[u++]=y;if(r.solveLateralMoving()>0){u=o;const e=r.__getArray(a)[u++],n=r.__getArray(a)[u++],i=r.__getArray(a)[u++],c=r.__getArray(a)[u++],s=r.__getArray(a)[u++],l=r.__getArray(a)[u++],y=r.__getArray(a)[u++],g=t.systems.rigidbody.gravity.y+y;return{velocity:new pc.Vec3(e,n,i),hit:new pc.Vec3(c,s,l),force:new pc.Vec3(0,-g,0),gravity:y}}return null}},console.info("Ballistics v1.0"),t.fire("ballistics:ready")})();return{}}();
